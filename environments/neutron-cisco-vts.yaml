# A Heat environment file which can be used to enable Cisco VTS extensions, configured via puppet

# By default optional items are commented out

resource_registry:
  OS::TripleO::Services::NeutronCorePlugin: OS::TripleO::Services::NeutronCorePluginVTS
  OS::TripleO::Services::ComputeNeutronCorePlugin: OS::Heat::None

  ## OVS and VTS Agent section
  # Disable OVS Agent for compute and controller
  OS::TripleO::Services::ComputeNeutronOvsAgent: OS::Heat::None
  OS::TripleO::Services::NeutronOvsAgent: OS::Heat::None

  ## Add VTS agent service. NOTE: VTS agent and OVS agent are mutually exclusive
  #OS::TripleO::Services::VTSAgent: ../puppet/services/neutron-cisco-vts-agent.yaml

  ## VPFA Configuration
  OS::TripleO::ComputeExtraConfigPre: /usr/share/openstack-tripleo-heat-templates/puppet/extraconfig/pre_deploy/cisco_vts_vpfa.yaml
  # Additional hook scripts for controller or all nodes. Enable/disable as needed
  #OS::TripleO::ControllerExtraConfigPre: /usr/share/openstack-tripleo-heat-templates/puppet/extraconfig/pre_deploy/cisco_vts_vpfa.yaml
  #OS::TripleO::NodeExtraConfig: /usr/share/openstack-tripleo-heat-templates/puppet/extraconfig/pre_deploy/cisco_vts_vpfa.yaml
  # Disable Neutron L3 agent that conflict with VPFA
  OS::TripleO::Services::NeutronL3Agent: OS::Heat::None

parameter_defaults:

  ###################
  ### VTS General ###
  ###################

  VTSUsername: 'admin'
  VTSPassword: ''
  VTSServer: '192.168.0.1'
  VTSVMMID: ''

  ###################
  ### Neutron ML2 ###
  ###################

  NeutronCorePlugin: 'neutron.plugins.ml2.plugin.Ml2Plugin'
  NeutronMechanismDrivers: 'sriovnicswitch,cisco_vts'
  NeutronTypeDrivers: 'vxlan,vlan,flat'
  NeutronServicePlugins: 'cisco_vts_router,trunk'
  NeutronInterfaceDriver: 'cisco_controller.drivers.agent.linux.interface.NamespaceDriver'

  ########################
  ### VTS Agent Config ###
  ########################

  VTSPhysicalNet: ''
  #VTSRetries: 15
  #VTSTimeout:
  #VTSPollingInterval: 6

  ###################
  ### VPFA Config ###
  ###################

  UnderlayIpNewtorksList: '11.0.0.1/24'
  VTSRIpAddressList: '10.0.0.1'
  #VPFAHostname: 'foo'
  #NetworkConfigMethod: 'static'
  #NetworkNameServerIP: ''
  #VifTypeCompute: 'vhostuser'
  #VifTypeController: 'tap'

  # Set common VTS Network Gateway address or set/override it in PerNodeData
  #VTSNetworkIPv4Gateway: '10.0.0.1'


  # VPFA Configuration requires the assignment of an underlay IP address for the VPFA per node.
  # This needs to be specified against the UUID of the target node in a JSON data blob.
  # To derive the UUID, after node introspection execute the following CLI command steps:
  #
  # 1. 'ironic node-list'. Note Openstack ID of the target node
  # 2. 'openstack baremetal introspection data save <Openstack ID from step1> | jq .extra.system.product.uuid
  # 3. Note the Node UUID and use it in the json configuration blob below. Multiple nodes can be specified.
  #
  # The per-node data can be used to set/override any of the cisco_vpfa:: module configuration parameters
  #
  PerNodeData: |
    {
      "< Node1 UUID >": {
          "cisco_vpfa::vtf_underlay_ip_v4": "10.0.0.2",
          "cisco_vpfa::vtf_underlay_mask_v4": "24",
          "cisco_vpfa::network_ipv4_gateway": "10.0.0.1"},
      "< Node2 UUID >": {
          "cisco_vpfa::vtf_underlay_ip_v4": "10.0.0.3",
          "cisco_vpfa::vtf_underlay_mask_v4": "24",
          "cisco_vpfa::network_ipv4_gateway": "10.0.0.1"}
    }

  ###################
  ### VPP Config  ###
  ###################

  #The CPUs listed below need to be part of the grub isol CPU list (configured elsewhere)

  #VppCpuMainCoreController: '0'
  #VppCpuCorelistWorkersController: ''
  #VppCpuMainCoreCompute: '0'
  #VppCpuCorelistWorkersCompute: ''

  #########################################################
  ### Special VPP Config - Not intended for general use ###
  #########################################################

  # Flag to control generation of VPP config. Set to "False" if using the OSPD VPP Module and os-net-config.
  VPFAInit: "False"

  # If above flag is set to True, the following parameters MUST be passed.
  #UnderlayInterface: 'ens224'
  #BondIfList: ''

  # When VPFAInit is set to true, the following VPP parameters need to be provided by means
  # of a json data e.g:
  #
  #VPPparams: |
  #  {"RECONFIGURE": "False",
  #  "ENABLE_VPP_WORKERS": "False",
  #  "ENABLE_JUMBO_FRAMES": "True",
  #  "ENABLE_LLDP": "True",
  #  "MAX_MTU_SIZE": "9000",
  #  "HEADERS_FOR_VPP": "64",
  #  "PCI_DRIVER": "uio_pci_generic",
  #  "HOSTCPUS": "2",
  #  "VIF_TYPE": "vhostuser",
  #  "VPPCPUS": "1",
  #  "L2_MODE": "True"}
